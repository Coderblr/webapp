import { useState, useEffect } from "react";
import { Menu, LogOut } from "lucide-react";
import { styles } from "../../styles/AppStyles";
import Sidebar from "./Sidebar";

import HomeView from "./HomeView";
import CifCreationView from "./CifCreationView";
import DepositAccountView from "./DepositAccountView";
import LoanAccountView from "./LoanAccountView";
import CcodAccountView from "./CcodAccountView";
import CkycView from "./CkycView";
import SocialAttributeView from "./SocialAttributeView";
import AmendView from "./AmendView";
import PanCifView from "./PanCifView";
import FundTransferView from "./FundTransferView";
import PpfView from "./PpfView";
import RdView from "./RdView";
import FoView from "./FoView";
import ExcelBatchView from "./ExcelBatchView";
import ModView from "./ModView";
import KccView from "./KccView";
import NocView from "./NocView";
import ErrorResolutionCentreView from "./ErrorResolutionCentreView";
import TellerResetView from "./TellerResetView";
import TellerSignonView from "./TellerSignonView";

const ADMIN_ONLY_SERVICES = ["unlockuser", "edituser"];

export default function Dashboard({ user, onLogout }) {
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [activeService, setActiveService] = useState("home");
  const [role, setRole] = useState("user");

  useEffect(() => {
    const storedRole = localStorage.getItem("userRole");
    if (!storedRole) {
      onLogout();
    } else {
      setRole(storedRole);
    }
  }, [onLogout]);

  const renderContent = () => {
    // ğŸ” HARD PROTECTION
    if (ADMIN_ONLY_SERVICES.includes(activeService) && role !== "admin") {
      return (
        <div style={styles.errorMsg}>
          ğŸš« Access Denied: Admin privileges required
        </div>
      );
    }

    switch (activeService) {
      case "home":
        return <HomeView user={user} />;

      case "cif":
        return <CifCreationView />;

      case "deposit":
        return <DepositAccountView />;

      case "loan":
        return <LoanAccountView />;

      case "ccod":
        return <CcodAccountView />;

      case "ckyc":
        return <CkycView />;

      case "social":
        return <SocialAttributeView />;

      case "amend":
        return <AmendView />;

      case "pancif":
        return <PanCifView />;

      case "fundtransfer":
        return <FundTransferView />;

      case "ppf":
        return <PpfView />;

      case "rd":
        return <RdView />;

      case "kcc":
        return <KccView />;

      case "mod":
        return <ModView />;

      case "noc":
        return <NocView />;

      case "fo":
        return <FoView />;

      case "tellerreset":
        return <TellerResetView />;

      case "tellersignon":
        return <TellerSignonView />;

      case "excel":
        return <ExcelBatchView />;

      case "error":
        return <ErrorResolutionCentreView />;

      default:
        return <HomeView user={user} />;
    }
  };

  return (
    <div style={styles.dashboardContainer}>
      {/* NAVBAR */}
      <nav style={styles.dashboardNav}>
        <div style={styles.dashNavLeft}>
          <button
            onClick={() => setSidebarOpen(!sidebarOpen)}
            style={styles.menuBtn}
          >
            <Menu size={24} />
          </button>

          <div style={styles.navBrand}>
            <div style={styles.logoCircleSmall}>SBI</div>
            <span style={styles.brandTextSmall}>Test Data Platform</span>
          </div>
        </div>

        <div style={styles.dashNavRight}>
          <div style={styles.userInfo}>
            <div style={styles.userAvatar}>
              {user?.first_name?.[0] || "U"}
            </div>
            <div style={styles.userDetails}>
              <span style={styles.userNameNav}>
                {user?.first_name} {user?.last_name}
              </span>
              <span style={styles.userRole}>
                Dept: {user?.department_code}
              </span>
            </div>
          </div>

          <button
            onClick={onLogout}
            style={styles.logoutBtnNav}
            title="Logout"
          >
            <LogOut size={18} />
          </button>
        </div>
      </nav>

      {/* MAIN */}
      <div style={styles.mainContainer}>
        <Sidebar
          sidebarOpen={sidebarOpen}
          activeService={activeService}
          setActiveService={setActiveService}
        />

        <main style={styles.content}>{renderContent()}</main>
      </div>
    </div>
  );
}