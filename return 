"use client";
import { useState } from "react";
import styles from "./page.module.css";

export default function AccountClosure() {
  const [accountNumber, setAccountNumber] = useState("");
  const [server, setServer] = useState("O");
  const [response, setResponse] = useState(null);
  const [error, setError] = useState("");

  const handleSubmit = async (event) => {
    event.preventDefault();
    setError("");
    setResponse(null);

    const url = "http://10.1.161.199:5050/acc_close"; // Change if needed

    try {
      const res = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          acc: accountNumber,
          server: server,
        }),
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(data?.detail || "Something went wrong");
      }

      setResponse(data);
    } catch (err) {
      console.error("Error:", err);
      setError(err.message);
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.form}>
        <h1>Account Closure</h1>

        <form onSubmit={handleSubmit}>
          <div className={styles.form_group}>
            <label>Account Number:</label>
            <input
              type="text"
              value={accountNumber}
              onChange={(e) => setAccountNumber(e.target.value)}
              required
            />
          </div>

          <div className={styles.form_group}>
            <label>Server:</label>
            <select
              value={server}
              onChange={(e) => setServer(e.target.value)}
              required
            >
              <option value="X">X - UAT</option>
              <option value="O">O - UAT</option>
              <option value="Y">Y - UAT</option>
              <option value="Z">Z - UAT</option>
              <option value="K">K - Pre-Prod</option>
              <option value="J">J - Pre-Prod</option>
              <option value="R1">R1 - Pre-Prod</option>
              <option value="Y2">Y2 - Pre-Prod</option>
              <option value="L">L - Pre-Prod</option>
              <option value="C">C - Pre-Prod</option>
            </select>
          </div>

          <button type="submit" className={styles.submitButton}>
            Close Account
          </button>
        </form>
      </div>

      <div className={styles.cif_data_container}>
        {error && (
          <div className={styles.resultItem}>
            <p style={{ color: "red" }}>Error: {error}</p>
          </div>
        )}

        {response && (
          <div className={styles.resultItem}>
            <p><strong>Server:</strong> {response.server}</p>
            <p><strong>Final Message:</strong> {response.final_message}</p>
            <p><strong>Raw Response:</strong> {response.response}</p>
            <p><strong>Extracted:</strong> {response.extracted}</p>
          </div>
        )}

        {!response && !error && (
          <p className={styles.noDataMessage}>
            No account closure data to display.
          </p>
        )}
      </div>
    </div>
  );
}